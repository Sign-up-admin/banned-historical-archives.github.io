# Cursor 终端等待问题修复指南

## 问题描述

在 Windows PowerShell 中，Cursor IDE 执行命令后可能会等待用户按回车键才继续，这是因为命令输出没有以换行符结束，导致终端状态检测失败。

## 快速修复方案

### 🚀 方案 1: 自动修复 package.json 脚本（最简单）

运行以下 PowerShell 脚本，自动修复所有 npm 脚本：

```powershell
.\scripts\fix-package-scripts.ps1
```

这个脚本会在所有相关命令末尾添加 `; Write-Output ""`，确保命令输出正确结束。

### 🎯 方案 2: 切换到 Git Bash（最佳长期方案）

1. 打开 `.vscode/settings.json` 文件
2. 取消注释以下行：
   ```json
   "terminal.integrated.defaultProfile.windows": "Git Bash",
   ```
3. 重启 Cursor

**或者** 在 Cursor 设置中：
1. 按 `Ctrl+,` 打开设置
2. 搜索 "terminal.integrated.defaultProfile.windows"
3. 将值改为 "Git Bash"

### 🔧 方案 3: 使用修复后的 PowerShell 配置

项目已包含 `.vscode/settings.json` 配置文件，其中包含优化的 PowerShell 设置。如果问题仍然存在，可以：

1. 在 Cursor 中打开终端
2. 点击终端下拉菜单
3. 选择 "PowerShell (Fixed)" 配置文件

### 📝 方案 4: 手动修复单个脚本

在 `package.json` 的脚本命令末尾添加 `; Write-Output ""`，例如：

```json
"scripts": {
  "dev": "next dev; Write-Output \"\"",
  "build": "npm run hack-mui && next build; Write-Output \"\""
}
```

## 验证修复

修复后，运行任意 npm 脚本，命令应该能够自动完成，不需要手动按回车键。

```powershell
npm run dev
# 命令结束后应该自动返回提示符，不需要按回车
```

## 技术说明

- **根本原因**: PowerShell 的某些输出格式（特别是没有以换行符结束的输出）导致 Cursor 无法正确检测命令完成状态
- **解决方案原理**: 在命令末尾添加 `Write-Output ""` 确保输出以换行符结束，让 Cursor 能够正确检测命令完成
- **最佳实践**: 使用 Git Bash 或 WSL 可以完全避免这个问题，因为这些终端的行为更符合 Unix 标准

## 相关文件

- `.vscode/settings.json` - Cursor/VSCode 终端配置
- `scripts/fix-package-scripts.ps1` - 自动修复脚本
- `scripts/run-with-newline.ps1` - 包装脚本（可选使用）

## 需要帮助？

如果问题仍然存在，请检查：
1. Cursor 是否已更新到最新版本
2. PowerShell 版本（建议使用 PowerShell 7+）
3. 是否有其他终端扩展或配置冲突

